# Gas Market Forecast Report

Generated on {{ metadata.generated_at }}
Provenance sidecars: {% if meta_files %}{% for path in meta_files %}[{{ path }}]({{ path }}){% if not loop.last %}, {% endif %}{% endfor %}{% else %}n/a{% endif %}

## Headline Call
{% set event_ctx = risk_context.get('event', {}) if risk_context else {} %}
{% set headline_threshold = posterior.final_threshold %}
{% set headline_pct = posterior.final_probability_pct %}
{% set headline_prob = posterior.final_probability %}
{% set headline_date = event_ctx.get('resolution_date') %}
{% if headline_prob is not none and headline_threshold is not none %}
**Final Probability:** {{ "%.1f"|format(headline_pct or (headline_prob * 100)) }}% that AAA national regular > ${{ "%.2f"|format(headline_threshold) }}{% if headline_date %} on {{ headline_date }}{% endif %}
{% else %}
**Final Probability:** n/a
{% endif %}

_As of {{ as_of_label }}._
> {{ posterior.thesis or "No thesis available." }}

## Data Sources & Provenance
| Source | Mode | As Of | Fresh | Records | Path |
| --- | --- | --- | --- | --- | --- |
{% for record in provenance -%}
| {{ record.source }} | {{ record.mode }} | {{ record.as_of|default("n/a", true) }} | {{ "yes" if record.fresh else "no" }} | {{ record.records|default("", true) }} | {{ record.path|default("", true) }} |
{% endfor %}

{% if risk_context and risk_context.get('kalshi') %}
> Market reference: series {{ risk_context['kalshi'].get('series_ticker') or 'n/a' }}, event {{ risk_context['kalshi'].get('event_ticker') or 'n/a' }} (Kalshi resolves off AAA).
{% endif %}

## Risk Dashboard
- NHC alert: **{{ "ON" if risk.nhc_alert else "OFF" }}** ({{ risk.details["nhc"]["active_storms"] }} active storms vs threshold {{ risk.details["nhc"]["threshold"] }})
- WPSR alert: **{{ "ON" if risk.wpsr_alert else "OFF" }}** (latest change {{ "%.2f"|format(risk.details["wpsr"]["latest_change"]) }} vs {{ "%.2f"|format(risk.details["wpsr"]["threshold"]) }})
- Tightness flag: **{{ "ON" if risk_flags["tightness"]["active"] else "OFF" }}**, draw {{ "%.2f"|format(risk_flags["tightness"]["gasoline_stocks_draw"]) }} mmbbl, refinery util {{ "%.1f"|format(risk_flags["tightness"]["refinery_util_pct"]) }}%
- NHC overrides: operational {{ "ON" if risk_flags["nhc"]["nhc_alert"] else "OFF" }}, analyst {{ "ON" if risk_flags["nhc"]["analyst_flag"] else "OFF" }}
{% if risk_flags["adjustments"] %}
- Tail adjustments: {% for note in risk_flags["adjustments"] -%}{{ note }}{% if not loop.last %}; {% endif %}{% endfor %}
{% else %}
- Tail adjustments: none
{% endif %}
{% if risk_context and risk_context.get("prior_weight_note") %}
- Prior weight calibration: {{ risk_context["prior_weight_note"] }}
{% endif %}

{% if risk_context %}
{% set wpsr = risk_context.get("wpsr", {}) %}
{% set nhc = risk_context.get("nhc", {}) %}
{% set event_ctx = risk_context.get("event", {}) %}
{% set adjustments = risk_context.get("adjustments", []) %}
{% set dataset_ctx = risk_context.get("dataset", {}) %}

### Risk Metrics
| Metric | Value | Trigger |
| --- | --- | --- |
| WPSR draw (mmbbl) | {{ "%.2f"|format(wpsr.get("draw_mmb", 0.0)) }} | > {{ "%.2f"|format(-wpsr.get("draw_trigger", 0.0)) }} |
| Refinery utilisation (%) | {{ "%.1f"|format(wpsr.get("refinery_util_pct", 0.0)) }} | < {{ "%.1f"|format(wpsr.get("util_trigger", 90.0)) }} |
| NHC active storms | {{ nhc.get("active_storms", 0) }} | > {{ nhc.get("threshold", 1) }} |
| Analyst override | {{ "ON" if nhc.get("analyst_flag") else "OFF" }} | Manual |
| Event date | {{ event_ctx.get("resolution_date", "n/a") }} | — |
| Event threshold (USD/gal) | {{ "%.2f"|format(event_ctx.get("threshold", 0.0)) }} | — |
| Days to event | {{ event_ctx.get("days_to_event", "n/a") }} | — |
| β_eff (Δpump / ΔRBOB) | {% if event_ctx.get("beta_eff") is not none %}{{ "%.4f"|format(event_ctx.get("beta_eff")) }}{% else %}n/a{% endif %} | — |
| Alpha lift applied (USD/gal) | {% if event_ctx.get("alpha_lift_applied") is not none %}{{ "%.4f"|format(event_ctx.get("alpha_lift_applied")) }}{% else %}n/a{% endif %} | — |
{% if adjustments %}
| Tail adjustments | {{ adjustments[0] }}{% for note in adjustments[1:] %}; {{ note }}{% endfor %} | — |
{% else %}
| Tail adjustments | none | — |
{% endif %}
| Dataset as_of | {{ dataset_ctx.get("as_of", "n/a") }} | — |
{% endif %}

![Risk Box]({{ figures.risk_box }})
_{{ figure_footer }}_

![Fundamentals Dashboard]({{ figures.fundamentals }})
_{{ figure_footer }}_

## Forecast Performance
### Ensemble Metrics
| Metric | Value |
| --- | --- |
{% for name, value in metrics.items() -%}
| {{ name }} | {{ "%.4f"|format(value) }} |
{% endfor %}

### Benchmarks
| Model | Brier | CRPS |
| --- | --- | --- |
{% for row in benchmarks -%}
{% set brier = row.get('brier') %}{% set crps = row.get('crps') %}
| {{ row.get('model') }} | {{ "%.4f"|format(brier) if brier is not none else "" }} | {{ "%.4f"|format(crps) if crps is not none else "" }} |
{% endfor %}
{% set freeze = risk_context.get('freeze_benchmarks') if risk_context else None %}
{% if freeze %}

### Freeze-date Metrics (central threshold)
| Model | Brier | CRPS |
| --- | --- | --- |
{% for row in freeze -%}
| {{ row.get('model') }} | {{ "%.4f"|format(row.get('brier')) if row.get('brier') is not none else "" }} | {{ "%.4f"|format(row.get('crps')) if row.get('crps') is not none else "" }} |
{% endfor %}
{% endif %}
{% set freeze_metrics = risk_context.get('freeze_metrics') if risk_context else None %}
{% if freeze_metrics %}

#### Freeze Snapshot
| Series | Date | Value (USD/gal) |
| --- | --- | --- |
{% set today = freeze_metrics.get('aaa_today') %}
| AAA today | {{ today.date if today else 'n/a' }} | {{ "%.4f"|format(today.value) if today and today.value is not none else 'n/a' }} |
{% set week = freeze_metrics.get('aaa_week_ago') %}
| AAA week-ago | {{ week.date if week else 'n/a' }} | {{ "%.4f"|format(week.value) if week and week.value is not none else 'n/a' }} |
{% set month = freeze_metrics.get('aaa_month_ago') %}
| AAA month-ago | {{ month.date if month else 'n/a' }} | {{ "%.4f"|format(month.value) if month and month.value is not none else 'n/a' }} |
{% set rbob = freeze_metrics.get('rbob_settle') %}
| RBOB settle | {{ rbob.date if rbob else 'n/a' }} | {{ "%.4f"|format(rbob.value) if rbob and rbob.value is not none else 'n/a' }} |

#### Freeze-date Parameters
| Parameter | Value |
| --- | --- |
| Event threshold | {{ "%.2f"|format(freeze_metrics.get('event_threshold')|default(0.0, true)) }} |
| Threshold gap | {{ "%.4f"|format(freeze_metrics.get('price_gap')|default(0.0, true)) }} |
| α lift | {{ "%.4f"|format(freeze_metrics.get('alpha_lift')|default(0.0, true)) }} |
| β_eff | {{ "%.4f"|format(freeze_metrics.get('beta_eff')|default(0.0, true)) }} |
| Prior weight | {{ "%.2f"|format(freeze_metrics.get('prior_weight')|default(0.0, true)) }} |
| Residual σ | {{ "%.4f"|format(freeze_metrics.get('residual_sigma')|default(0.0, true)) }} |
| Point forecast | {{ "%.4f"|format(freeze_metrics.get('point_forecast')|default(0.0, true)) }} |
| Tail probability | {{ "%.2f"|format((freeze_metrics.get('tail_probability')|default(0.0, true)) * 100) }}% |
| WTI proxy | {{ freeze_metrics.get('wti_proxy') if freeze_metrics.get('wti_proxy') is not none else 'n/a' }} |
{% endif %}
{% if jackknife %}

**Jackknife Stability:** {{ jackknife }}
{% endif %}

### Calibration Table
| Forecast Bin | Observed Frequency | Count |
| --- | --- | --- |
{% for row in calibration -%}
| {{ "%.2f"|format(row["forecast_mean"]|default(0, true)) }} | {{ "%.2f"|format(row["outcome_rate"]|default(0, true)) }} | {{ row["count"]|default(0, true) }} |
{% endfor %}

![Forecast vs Actual]({{ figures.forecast }})
_{{ figure_footer }}_

![Calibration Curve]({{ figures.calibration }})
_{{ figure_footer }}_

## Model Outputs
![Sensitivity Bars]({{ figures.sensitivity }})
_{{ figure_footer }}_

![AAA Daily Δ Histogram]({{ figures.delta_hist }})
_{{ figure_footer }}_

{% set horizon_threshold = posterior.final_threshold or posterior.event_threshold %}
{% if tplus1_sensitivity %}
_Horizon-aware T+1 adjustments:_

| Scenario | β_eff | Δα | ΔP(> {{ "%.2f"|format(horizon_threshold) }}) |
| --- | --- | --- | --- |
{% for row in tplus1_sensitivity -%}
| {{ row["scenario"] }} | {{ "%.4f"|format(row.get("beta_eff", 0.0)) }} | {{ "%+.1f"|format((row.get("alpha_delta", 0.0) or 0.0) * 100) }}¢ | {{ "%+.2f"|format(row.get("prob_delta_pp", 0.0)) }}pp |
{% endfor %}
{% endif %}

### Posterior Snapshot
- Mean: {{ "%.4f"|format(posterior.mean) }}
- Variance: {{ "%.4f"|format(posterior.variance) }}
- 90% CI: [{{ "%.4f"|format(posterior.ci_5) }}, {{ "%.4f"|format(posterior.ci_95) }}] ({{ "%.4f"|format(posterior.ci_lower_span) }} down / {{ "%.4f"|format(posterior.ci_upper_span) }} up)
- 80% CI: [{{ "%.4f"|format(posterior.ci_10) }}, {{ "%.4f"|format(posterior.ci_90) }}]
- Prior weight: {{ "%.2f"|format(posterior.prior_weight) }} ({{ posterior.prior_weight_source }})
{% if asymmetry_ci %}
- Asymmetry: Δβ = {{ "%.4f"|format(asymmetry_ci[0]) }} (95% CI [{{ "%.4f"|format(asymmetry_ci[1]) }}, {{ "%.4f"|format(asymmetry_ci[2]) }}])
{% endif %}
{% for key, value in posterior.items() if key.startswith("prob_gt_") -%}
- P(X > {{ key[8:] }}) = {{ "%.4f"|format(value) }}
{% endfor %}
{% if posterior.dataset_digest %}
- Dataset digest: {{ posterior.dataset_digest }}
{% endif %}

{% if risk_context %}
{% set alpha_note = risk_context.get('alpha_note') %}
{% if alpha_note %}

_α_t note_: {{ alpha_note }}
{% endif %}
{% endif %}

![Pass-through Fit]({{ figures.pass_through }})
_{{ figure_footer }}_

![Market-implied Prior CDF]({{ figures.prior_cdf }})
_{{ figure_footer }}_

![Posterior Density]({{ figures.posterior }})
_{{ figure_footer }}_

### Sensitivity Grid (Detail)
| Threshold | ΔRBOB | ΔAlpha | Prob > Threshold |
| --- | --- | --- | --- |
{% for row in sensitivity -%}
| {{ "%.2f"|format(row["threshold"]) }} | {{ "%.3f"|format(row["rbob_delta"]) }} | {{ "%.3f"|format(row["alpha_delta"]) }} | {{ "%.4f"|format(row["prob_above"]) }} |
{% endfor %}

## Appendix: Meta Files
{% for path in meta_files -%}
- {{ path }}
{% endfor %}
{% if submission_sha %}
- Submission SHA: {{ submission_sha }}
{% else %}
- Submission SHA: _(run `git rev-parse HEAD` at final freeze and paste here)_
{% endif %}
